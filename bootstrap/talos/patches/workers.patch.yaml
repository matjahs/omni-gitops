---
# Longhorn Talos support per docs 1.9.2
# Prepare dedicated disk, ensure rshared propagation, load required modules.
- op: add
  path: /machine/filesystems/-
  value:
    device: /dev/sdb
    format: ext4
    mountpoint: /var/lib/longhorn
    options: [defaults]
- op: add
  path: /machine/kubelet/extraMounts/-
  value:
    destination: /var/lib/longhorn
    type: bind
    source: /var/lib/longhorn
    options: [bind, rshared, rw]
- op: add
  path: /machine/kernel/modules/-
  value:
    name: iscsi_tcp
- op: add
  path: /machine/kernel/modules/-
  value:
    name: nbd
